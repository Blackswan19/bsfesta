<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>BsFesta - My Playlist</title> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"> <link rel="icon" type="image/x-icon" href="logo/logo.png"> <link rel="stylesheet" href="playlistmix.css"> <style> /* Scrollbar Styles */ ::-webkit-scrollbar { width: 10px; position: fixed; left: -3%; } ::-webkit-scrollbar-track { background: #00000000; } ::-webkit-scrollbar-thumb { background: #484848; height: 15%; outline: none; } ::-webkit-scrollbar-thumb:hover { background: #9b9b9b; } .image-container { text-align: center; margin-bottom: 10px; } .image-container img { width: 100px; height: 100px; object-fit: cover; border-radius: 5px; } .popup-song-item { display: flex; align-items: center; padding: 5px; } #playlist-options li { padding: 10px; cursor: pointer; } #playlist-options li:hover { background: #333; } /* Custom Menu */ .custom-menu { display: none; position: fixed; background-color: #262626; border: 1px solid #242424; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 1000; padding: 10px; border-radius: 5px; filter: drop-shadow(11px 12px 22px black); } .custom-menu button { display: block; width: 100%; border: none; background: none; text-align: left; padding: 12px; cursor: pointer; font-size: 18px; color: white; } .custom-menu button:hover { background-color: #404040; } a { text-decoration: none; } </style> </head> <body> <div class="loading-screen"> <img class="frombs" src="logo/frombs.png" alt=""> My Playlist <img src="logo/brand.png" class="img" alt="" width="5%"> <h1>BsFesta</h1> </div> <div class="playlist-container" id="playlist-container"> <button class="back-btn" id="back-btn" style="position: fixed;"><i class="fa-solid fa-arrow-left"></i></button> <h3 id="current-playlist-name">Playlists</h3> <ul id="playlist-list"></ul> <ul id="song-list"></ul> </div> <div class="songslist"> <div class="album-art"> <div class="logolike"> <img style="width: 100%; border-radius: 50px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); background: #ffffff21; border: solid 1.5px #ffffff61;" src="logo/playing.jpg" alt=""> </div> </div> <div class="song-info"> Playing: <p class="title"></p> <p class="artist" style=" display: flex ; gap: 6px; position: fixed; left: 20px; align-items: center; "><img style="width: 4%" src="logo/brand.png" alt=""> My Playlist</p> <p class="album">BsFesta</p> </div> <div class="progress-container"> <div class="progress" id="progress"></div> </div> <div class="controlss"> <button id="repeat-btn" title="Repeat"><i class="fa-solid fa-rotate-right fa-repeat"></i></button> <button id="previous-btn"><?xml class="fa-solid fa-backward-step" version="1.0" encoding="UTF-8"?><svg style="rotate: 180deg;" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="512" height="512"><path d="M22.5,21c-.828,0-1.5-.671-1.5-1.5V4.5c0-.829,.672-1.5,1.5-1.5s1.5,.671,1.5,1.5v15c0,.829-.672,1.5-1.5,1.5Zm-5,0c-.828,0-1.5-.671-1.5-1.5V4.5c0-.829,.672-1.5,1.5-1.5s1.5,.671,1.5,1.5v15c0,.829-.672,1.5-1.5,1.5Zm-13.874-.421c-.559,0-1.12-.13-1.641-.394-1.225-.621-1.985-1.859-1.985-3.232V7.047c0-1.373,.761-2.611,1.985-3.231,1.209-.614,2.687-.494,3.781,.311l6.754,4.953c.94,.689,1.48,1.754,1.48,2.921s-.54,2.232-1.481,2.922l-6.754,4.953c-.635,.467-1.384,.705-2.139,.705Zm.003-14.161c-.096,0-.193,.024-.289,.073-.223,.113-.341,.305-.341,.556v9.906c0,.25,.118,.442,.341,.556,.224,.113,.448,.095,.649-.053l6.755-4.954c.167-.122,.254-.295,.254-.502s-.088-.38-.254-.502L3.991,6.544c-.115-.084-.236-.126-.361-.126Z"/></svg></button> <button class="play-pause-btn" id="playPauseBtn"><i class="fa-solid fa-play" id="playIcon"></i></button> <button id="next-btn"><?xml class="fa-solid fa-forward-step" version="1.0" encoding="UTF-8"?> <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24" width="512" height="512"><path d="M22.5,21c-.828,0-1.5-.671-1.5-1.5V4.5c0-.829,.672-1.5,1.5-1.5s1.5,.671,1.5,1.5v15c0,.829-.672,1.5-1.5,1.5Zm-5,0c-.828,0-1.5-.671-1.5-1.5V4.5c0-.829,.672-1.5,1.5-1.5s1.5,.671,1.5,1.5v15c0,.829-.672,1.5-1.5,1.5Zm-13.874-.421c-.559,0-1.12-.13-1.641-.394-1.225-.621-1.985-1.859-1.985-3.232V7.047c0-1.373,.761-2.611,1.985-3.231,1.209-.614,2.687-.494,3.781,.311l6.754,4.953c.94,.689,1.48,1.754,1.48,2.921s-.54,2.232-1.481,2.922l-6.754,4.953c-.635,.467-1.384,.705-2.139,.705Zm.003-14.161c-.096,0-.193,.024-.289,.073-.223,.113-.341,.305-.341,.556v9.906c0,.25,.118,.442,.341,.556,.224,.113,.448,.095,.649-.053l6.755-4.954c.167-.122,.254-.295,.254-.502s-.088-.38-.254-.502L3.991,6.544c-.115-.084-.236-.126-.361-.126Z"/></svg> </button> <button id="shuffle-btn" title="Shuffle"> <svg data-encore-id="icon" role="img" class="fa-shuffle" aria-hidden="true" class="e-91000-icon e-91000-baseline" viewBox="0 0 16 16" style="--encore-icon-height: var(--encore-graphic-size-decorative-smaller); --encore-icon-width: var(--encore-graphic-size-decorative-smaller);"><path d="M13.151.922a.75.75 0 1 0-1.06 1.06L13.109 3H11.16a3.75 3.75 0 0 0-2.873 1.34l-6.173 7.356A2.25 2.25 0 0 1 .39 12.5H0V14h.391a3.75 3.75 0 0 0 2.873-1.34l6.173-7.356a2.25 2.25 0 0 1 1.724-.804h1.947l-1.017 1.018a.75.75 0 0 0 1.06 1.06L15.98 3.75zM.391 3.5H0V2h.391c1.109 0 2.16.49 2.873 1.34L4.89 5.277l-.979 1.167-1.796-2.14A2.25 2.25 0 0 0 .39 3.5z"></path><path d="m7.5 10.723.98-1.167.957 1.14a2.25 2.25 0 0 0 1.724.804h1.947l-1.017-1.018a.75.75 0 1 1 1.06-1.06l2.829 2.828-2.829 2.828a.75.75 0 1 1-1.06-1.06L13.109 13H11.16a3.75 3.75 0 0 1-2.873-1.34l-.787-.938z"></path></svg></button> <button id="list-btn" title="Show Playlists"><?xml version="1.0" encoding="UTF-8"?><svg class="fa-solid fa-list" style=" width: 16px;fill: white;" xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24"><path d="m23,0h-1c-2.757,0-5,2.243-5,5v9.261c-.952-.787-2.172-1.261-3.5-1.261-3.032,0-5.5,2.467-5.5,5.5s2.468,5.5,5.5,5.5,5.5-2.467,5.5-5.5V5c0-1.654,1.346-3,3-3h1c.553,0,1-.448,1-1s-.447-1-1-1ZM0,1C0,.448.447,0,1,0h11c.553,0,1,.448,1,1s-.447,1-1,1H1c-.553,0-1-.448-1-1Zm0,6c0-.552.447-1,1-1h11c.553,0,1,.448,1,1s-.447,1-1,1H1c-.553,0-1-.448-1-1Zm8,6c0,.552-.447,1-1,1H1c-.553,0-1-.448-1-1s.447-1,1-1h6c.553,0,1,.448,1,1Z"/></svg></button> <div class="volume-control"> <?xml version="1.0" encoding="UTF-8"?><svg style="width: 16px; fill: white; height: 16px;" xmlns="http://www.w3.org/2000/svg" id="Filled" viewBox="0 0 24 24" width="512" height="512"><path d="M20.8,4.293A1,1,0,0,0,19.39,5.707a8.911,8.911,0,0,1,0,12.586A1,1,0,1,0,20.8,19.707,10.911,10.911,0,0,0,20.8,4.293Z"/><path d="M18.093,7.293a1,1,0,1,0-1.414,1.414,4.664,4.664,0,0,1,0,6.586,1,1,0,1,0,1.414,1.414A6.665,6.665,0,0,0,18.093,7.293Z"/><path d="M13.819.207A12.055,12.055,0,0,0,6.268,5H5a5.006,5.006,0,0,0-5,5v4a5.006,5.006,0,0,0,5,5H6.269a12.051,12.051,0,0,0,7.55,4.793A1,1,0,0,0,15,22.81V1.19A1,1,0,0,0,13.819.207Z"/></svg><input type="range" id="volume-slider" min="0" max="1" step="0.01" value="1"> </div> </div> <button id="lights-btn">ðŸŒ™</button> </div> <div class="custom-menu"> <a href="https://blackswan19.github.io/bsfesta/music"><button id="option1">Go to BsFesta</button></a> <a href="https://blackswan19.github.io/bsfesta/likedlist"><button id="option2">Go to Liked one</button></a> <a href="https://blackswan19.github.io/bsfesta/minifesta"><button id="option2">Go to Mini Festa</button></a> <a href="https://blackswan19.github.io/bscrop/formbs"><button id="option2">More From BS</button></a> <a href="https://blackswan19.github.io/bsfesta/addhome"><button id="option2">Add to Home</button></a> </div>
<script>
        const playlistList = document.getElementById("playlist-list");
        const songList = document.getElementById("song-list");
        const currentPlaylistName = document.getElementById("current-playlist-name");
        const backBtn = document.getElementById("back-btn");
        const progressBar = document.getElementById("progress");
        const progressContainer = document.querySelector(".progress-container");
        const playPauseBtn = document.getElementById("playPauseBtn");
        const playIcon = document.getElementById("playIcon");
        const previousBtn = document.getElementById("previous-btn");
        const nextBtn = document.getElementById("next-btn");
        const shuffleBtn = document.getElementById("shuffle-btn");
        const repeatBtn = document.getElementById("repeat-btn");
        const listBtn = document.getElementById("list-btn");
        const lightsBtn = document.getElementById("lights-btn");
        const playlistContainer = document.getElementById("playlist-container");
        const volumeSlider = document.getElementById("volume-slider");
        const songslist = document.querySelector(".songslist");
        const popupOverlay = document.getElementById("popup-overlay");
        const addToPlaylistOverlay = document.getElementById("add-to-playlist-overlay");
        const playlistOptions = document.getElementById("playlist-options");
        const popupPlaylistName = document.getElementById("popup-playlist-name");
        const songsPopupOverlay = document.getElementById("songs-popup-overlay");
        const songsPopupList = document.getElementById("songs-popup-list");
        const songsPopupTitle = document.getElementById("songs-popup-title");

        let playlists = JSON.parse(localStorage.getItem("playlists")) || {};
        let playlistImages = JSON.parse(localStorage.getItem("playlistImages")) || {};
        let songImages = JSON.parse(localStorage.getItem("songImages")) || {};
        let currentAudio = null;
        let audio = new Audio(); // For popup playback
        let currentlyPlayingLi = null;
        let currentPlaylistNameValue = null;
        let currentSongIndex = -1;
        let progressInterval;
        let isShuffling = false;
        let playedIndices = [];
        let repeatMode = 0;
        let showingSongs = false;
        let isLightsOn = false;
        let currentSong = null;
        let currentlyPlayingIndex = null;
        let isPlaying = false;
        const lightColors = ['#FF0000', '#0000FF', '#32CD32', '#FF1493', '#FFA500', '#00BFFF', '#FF4500', '#1E90FF', '#9400D3', '#FF6347', '#40E0D0', '#8A2BE2'];
        let colorIndex = 0;

        // Loading screen
        setTimeout(() => {
            document.querySelector('.loading-screen').style.display = 'none';
            document.getElementById('player-interface').style.display = 'block';
            initializePlaylists();
        }, 1500);
        function initializePlaylists() {
            if (Object.keys(playlists).length === 0) {
                playlists = {
                    "MyPlaylist": [
                        { title: "like JENNIE", src: "path/to/song1.mp3", artist: "JENNIE", album: "Ruby" },
                        { title: "Song 2", src: "path/to/song2.mp3", artist: "Artist 2", album: "Album 2" },
                        { title: "Song 3", src: "path/to/song3.mp3", artist: "Artist 3", album: "Album 3" }
                    ],
                    "Favorites": [
                        { title: "Song A", src: "path/to/songA.mp3", artist: "Artist A", album: "Album A" }
                    ]
                };
                songImages = {
                    "like JENNIE": "logo/song.png",
                    "Song 2": "logo/song.png",
                    "Song 3": "logo/song.png",
                    "Song A": "logo/song.png"
                };
                localStorage.setItem("playlists", JSON.stringify(playlists));
                localStorage.setItem("songImages", JSON.stringify(songImages));
            }
            loadPlaylists();
            updateAllSongIcons();
        }
        function openPopup() {
            popupPlaylistName.value = "";
            popupOverlay.style.display = "flex";
        }

        function closePopup() {
            popupOverlay.style.display = "none";
        }

        function createPlaylist() {
            const name = popupPlaylistName.value.trim();
            if (name && !playlists[name]) {
                playlists[name] = [];
                playlistImages[name] = null;
                savePlaylists();
                closePopup();
            }
        }

        function savePlaylists() {
            localStorage.setItem("playlists", JSON.stringify(playlists));
            localStorage.setItem("playlistImages", JSON.stringify(playlistImages));
            localStorage.setItem("songImages", JSON.stringify(songImages));
            loadPlaylists();
            updateAllSongIcons();
        }

        function loadPlaylists() {
            playlistList.innerHTML = "";
            if (Object.keys(playlists).length === 0) {
                playlistList.innerHTML = "<li>No playlists available</li>";
                return;
            }
            Object.keys(playlists).forEach(displayPlaylist);
        }

        function displayPlaylist(name) {
            const li = document.createElement("li");
            li.classList.add("playlist-item");
            li.innerHTML = `
                <img src="${playlistImages[name] || 'logo/playlist.png'}" alt="" style="width: 13%;
    margin: 0px 10px 0px -9px;
    border-radius: 8px;
    background: #ffffff61;
    opacity: 100%;">
                <span style="flex-grow: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; font-weight: 800; font-size: 18px;">${name}</span>
                <i class="fa-regular fa-trash-can delete-playlist" title="Delete Playlist"></i>
            `;
            const deleteBtn = li.querySelector(".delete-playlist");
            deleteBtn.addEventListener("click", (e) => {
                e.stopPropagation();
                delete playlists[name];
                delete playlistImages[name];
                savePlaylists();
            });
            li.addEventListener("click", () => {
                displaySongsInList(name);
                displaySongsInPopup(name);
            });
            playlistList.appendChild(li);
        }
        function displaySongsInList(playlistName) {
            songList.innerHTML = "";
            if (!playlists[playlistName]) {
                songList.innerHTML = "<li>Playlist not found</li>";
                return;
            }
            playlists[playlistName].forEach((song, index) => {
                const songLi = document.createElement("li");
                songLi.setAttribute("data-src", song.src);
                songLi.innerHTML = `
                    <span class="song-title">${song.title}</span>
                    <i class="fa-solid fa-play play-song" title="Play"></i>
                    
                `;
                songLi.addEventListener("click", () => {
                    currentSongIndex = index;
                    playedIndices = [index];
                    updateSongInfo(song.title, song.artist || playlistName, song.album || '');
                    playSong(song.src, songLi, playlistName);
                });
                if (currentSongIndex === index && currentPlaylistNameValue === playlistName) {
                    songLi.classList.add("playing");
                }
                songList.appendChild(songLi);
            });
            showingSongs = true;
            currentPlaylistName.textContent = `Playlist: ${playlistName}`;
            playlistList.style.display = "none";
            songList.classList.add("active");
            songList.style.display = "block";
            backBtn.style.display = "block";
        }

        function playSong(src, songLi, playlistName) {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
                if (currentlyPlayingLi) {
                    currentlyPlayingLi.classList.remove("playing");
                    togglePlayIcon(currentlyPlayingLi, false);
                }
            }
            if (audio) {
                audio.pause();
                isPlaying = false;
            }
            currentAudio = new Audio(src);
            currentAudio.volume = volumeSlider.value;
            currentAudio.play().catch(error => console.log("Audio play error:", error));
            togglePlayIcon(songLi, true);
            songLi.classList.add("playing");
            playIcon.classList.replace("fa-play", "fa-pause");
            currentlyPlayingLi = songLi;
            currentPlaylistNameValue = playlistName;
            changeLights();
            currentAudio.onended = playNextSong;
            updateProgressBar();
            // previousBtn.style.opacity = "1";
            // nextBtn.style.opacity = "1";
            if (showingSongs && playlistContainer.classList.contains("active")) {
                displaySongsInList(playlistName);
            }
        }

        function updateSongInfo(title, artist, album) {
            document.querySelector('.song-info .title').textContent = title;
            document.querySelector('.song-info .artist').textContent = artist;
            document.querySelector('.song-info .album').textContent = album ? `PLAYING FROM ALBUM ${album}` : '';
            const albumArtImg = document.querySelector('.album-art .logolike img');
            albumArtImg.src = songImages[title] || 'https://raw.githubusercontent.com/Tarikul-Islam-Anik/Telegram-Animated-Emojis/refs/heads/main/Objects/Musical%20Notes.webp';
        }
        function displaySongsInPopup(playlistName) {
            songsPopupTitle.textContent = `Playlist - ${playlistName}`;
            songsPopupList.innerHTML = "";
            const existingImageContainer = document.querySelector(".popup .image-container");
            if (existingImageContainer) existingImageContainer.remove();
            const imageContainer = document.createElement("div");
            imageContainer.className = "image-container";
            const img = document.createElement("img");
            img.src = playlistImages[playlistName] || "logo/playlist.png";
            imageContainer.appendChild(img);
            const changeImageBtn = document.createElement("button");
            changeImageBtn.textContent = "Change Playlist Image";
            changeImageBtn.addEventListener("click", () => {
                const input = document.createElement("input");
                input.type = "file";
                input.accept = "image/*";
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        cropImageToSquare(file, (dataUrl) => {
                            playlistImages[playlistName] = dataUrl;
                            savePlaylists();
                            displaySongsInPopup(playlistName);
                        });
                    }
                };
                input.click();
            });
            const deleteImageBtn = document.createElement("button");
            deleteImageBtn.textContent = "Delete Playlist Image";
            deleteImageBtn.addEventListener("click", () => {
                playlistImages[playlistName] = null;
                savePlaylists();
                displaySongsInPopup(playlistName);
            });
            imageContainer.appendChild(changeImageBtn);
            imageContainer.appendChild(deleteImageBtn);
            const popup = songsPopupOverlay.querySelector(".popup");
            popup.insertBefore(imageContainer, songsPopupTitle.nextSibling);
            playlists[playlistName].forEach((song, index) => {
                const songLi = document.createElement("li");
                songLi.classList.add("popup-song-item");
                songLi.innerHTML = `
                    <img src="${songImages[song.title] || 'logo/song.png'}" alt="" style="width: 40px; height: 40px; object-fit: cover; border-radius: 5px; margin-right: 10px;">
                    <span style="flex-grow: 1;">${song.title}</span>
                    <i class="fa-solid fa-play play-song" title="Play"></i>
                    <i class="fa-solid fa-image change-song-image" title="Change Image"></i>
                    <i class="fa-solid fa-trash delete-song-image" title="Delete Image"></i>
                    <i class="fa-solid fa-delete-left delete-song" title="Delete"></i>
                `;
                const playBtn = songLi.querySelector(".play-song");
                const changeImageBtn = songLi.querySelector(".change-song-image");
                const deleteImageBtn = songLi.querySelector(".delete-song-image");
                const deleteBtn = songLi.querySelector(".delete-song");
                if (playBtn) {
                    playBtn.addEventListener("click", (e) => {
                        e.stopPropagation();
                        if (isPlaying && currentlyPlayingIndex === index) {
                            audio.pause();
                            isPlaying = false;
                            updatePopupPlayIcons(playlistName);
                        } else {
                            if (currentAudio) {
                                currentAudio.pause();
                                if (currentlyPlayingLi) {
                                    currentlyPlayingLi.classList.remove("playing");
                                    togglePlayIcon(currentlyPlayingLi, false);
                                }
                            }
                            audio.src = song.src;
                            audio.play().catch(error => console.error('Error playing audio:', error));
                            isPlaying = true;
                            currentlyPlayingIndex = index;
                            updatePopupPlayIcons(playlistName, index);
                        }
                    });
                }
                if (changeImageBtn) {
                    changeImageBtn.addEventListener("click", (e) => {
                        e.stopPropagation();
                        const input = document.createElement("input");
                        input.type = "file";
                        input.accept = "image/*";
                        input.onchange = (e) => {
                            const file = e.target.files[0];
                            if (file) {
                                cropImageToSquare(file, (dataUrl) => {
                                    songImages[song.title] = dataUrl;
                                    savePlaylists();
                                    displaySongsInPopup(playlistName);
                                    displaySongsInList(playlistName);
                                });
                            }
                        };
                        input.click();
                    });
                }
                if (deleteImageBtn) {
                    deleteImageBtn.addEventListener("click", (e) => {
                        e.stopPropagation();
                        delete songImages[song.title];
                        savePlaylists();
                        displaySongsInPopup(playlistName);
                        displaySongsInList(playlistName);
                    });
                }
                if (deleteBtn) {
                    deleteBtn.addEventListener("click", (e) => {
                        e.stopPropagation();
                        playlists[playlistName].splice(index, 1);
                        savePlaylists();
                        displaySongsInPopup(playlistName);
                        displaySongsInList(playlistName);
                    });
                }
                songsPopupList.appendChild(songLi);
            });
            songsPopupOverlay.style.display = "flex";
        }

        function updatePopupPlayIcons(playlistName, playingIndex = null) {
            const songItems = songsPopupList.querySelectorAll('.popup-song-item');
            songItems.forEach((item, index) => {
                const playIcon = item.querySelector('.play-song');
                if (playIcon) {
                    if (index === playingIndex) {
                        playIcon.classList.replace('fa-play', 'fa-pause');
                    } else {
                        playIcon.classList.replace('fa-pause', 'fa-play');
                    }
                }
            });
        }

        function closeSongsPopup() {
            songsPopupOverlay.style.display = "none";
            audio.pause();
            isPlaying = false;
            updatePopupPlayIcons(null);
        }
        function openAddToPlaylistPopup(song) {
            currentSong = song;
            playlistOptions.innerHTML = "";
            Object.keys(playlists).forEach(name => {
                const li = document.createElement("li");
                li.textContent = name;
                li.classList.add("playlist-option");
                li.addEventListener("click", () => addToPlaylist(name));
                playlistOptions.appendChild(li);
            });
            addToPlaylistOverlay.style.display = "flex";
        }

        function closeAddToPlaylistPopup() {
            addToPlaylistOverlay.style.display = "none";
        }

        function addToPlaylist(playlistName) {
            if (currentSong && !playlists[playlistName].some(s => s.title === currentSong.title)) {
                currentSong.image = songImages[currentSong.title] || null;
                playlists[playlistName].push(currentSong);
                savePlaylists();
                const songElements = document.querySelectorAll('#song-list li');
                songElements.forEach(songElement => {
                    const songTitleElement = songElement.querySelector('.song-title');
                    const songTitle = songTitleElement ? songTitleElement.textContent : '';
                    if (songTitle === currentSong.title) {
                        updateSongIcon(songElement, true);
                    }
                });
            }
            closeAddToPlaylistPopup();
        }

        function updateSongIcon(songElement, isAdded) {
            const addBtn = songElement.querySelector('.add-to-playlist');
            if (addBtn) {
                if (isAdded) {
                    addBtn.classList.remove('fa-plus');
                    addBtn.classList.add('fa-circle-check');
                } else {
                    addBtn.classList.remove('fa-circle-check');
                    addBtn.classList.add('fa-plus');
                }
            }
        }

        function updateAllSongIcons() {
            const songElements = document.querySelectorAll('#song-list li');
            songElements.forEach(songElement => {
                const songTitleElement = songElement.querySelector('.song-title');
                const songTitle = songTitleElement ? songTitleElement.textContent : '';
                let isInPlaylist = false;
                Object.values(playlists).forEach(playlist => {
                    if (playlist.some(song => song.title === songTitle)) {
                        isInPlaylist = true;
                    }
                });
                updateSongIcon(songElement, isInPlaylist);
            });
        }
        function cropImageToSquare(file, callback) {
            const reader = new FileReader();
            reader.onload = (event) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement("canvas");
                    const ctx = canvas.getContext("2d");
                    const size = Math.min(img.width, img.height);
                    canvas.width = 150;
                    canvas.height = 150;
                    const srcX = (img.width - size) / 2;
                    const srcY = (img.height - size) / 2;
                    ctx.drawImage(img, srcX, srcY, size, size, 0, 0, 150, 150);
                    const dataUrl = canvas.toDataURL("image/jpeg", 0.8);
                    callback(dataUrl);
                };
                img.src = event.target.result;
            };
            reader.readAsDataURL(file);
        }
        function togglePlayPause() {
            if (currentAudio) {
                if (currentAudio.paused) {
                    currentAudio.play().catch(error => console.log("Audio play error:", error));
                    playIcon.classList.replace("fa-play", "fa-pause");
                    updateProgressBar();
                } else {
                    currentAudio.pause();
                    playIcon.classList.replace("fa-pause", "fa-play");
                    clearInterval(progressInterval);
                }
            }
        }

        function playNextSong() {
            if (!currentPlaylistNameValue) return;
            const currentPlaylist = playlists[currentPlaylistNameValue];
            if (repeatMode === 2) {
                currentAudio.currentTime = 0;
                currentAudio.play();
                return;
            }
            if (isShuffling) {
                if (playedIndices.length >= currentPlaylist.length && repeatMode === 1) {
                    playedIndices = [];
                } else if (playedIndices.length >= currentPlaylist.length) {
                    resetPlayer();
                    return;
                }
                let nextIndex;
                do {
                    nextIndex = Math.floor(Math.random() * currentPlaylist.length);
                } while (playedIndices.includes(nextIndex));
                playedIndices.push(nextIndex);
                currentSongIndex = nextIndex;
            } else {
                currentSongIndex++;
                if (currentSongIndex >= currentPlaylist.length && repeatMode === 1) {
                    currentSongIndex = 0;
                }
            }
            if (currentSongIndex < currentPlaylist.length && currentSongIndex >= 0) {
                const nextSong = currentPlaylist[currentSongIndex];
                const nextSongLi = Array.from(songList.querySelectorAll("li"))[currentSongIndex];
                updateSongInfo(nextSong.title, nextSong.artist || currentPlaylistNameValue, nextSong.album || '');
                playSong(nextSong.src, nextSongLi, currentPlaylistNameValue);
            } else {
                resetPlayer();
            }
        }

        function playPreviousSong() {
            if (!currentPlaylistNameValue) return;
            const currentPlaylist = playlists[currentPlaylistNameValue];
            if (isShuffling && playedIndices.length > 1) {
                playedIndices.pop();
                currentSongIndex = playedIndices[playedIndices.length - 1];
            } else {
                currentSongIndex--;
                if (currentSongIndex < 0 && repeatMode === 1) {
                    currentSongIndex = currentPlaylist.length - 1;
                }
            }
            if (currentSongIndex >= 0) {
                const prevSong = currentPlaylist[currentSongIndex];
                const prevSongLi = Array.from(songList.querySelectorAll("li"))[currentSongIndex];
                updateSongInfo(prevSong.title, prevSong.artist || currentPlaylistNameValue, prevSong.album || '');
                playSong(prevSong.src, prevSongLi, currentPlaylistNameValue);
            }
        }

        function resetPlayer() {
            if (currentAudio) {
                currentAudio.pause();
                if (currentlyPlayingLi) {
                    currentlyPlayingLi.classList.remove("playing");
                    togglePlayIcon(currentlyPlayingLi, false);
                }
                playIcon.classList.replace("fa-pause", "fa-play");
                clearInterval(progressInterval);
                currentAudio = null;
                currentlyPlayingLi = null;
                currentSongIndex = -1;
                playedIndices = [];
                progressBar.style.width = "0%";
                previousBtn.style.opacity = "0.2";
                nextBtn.style.opacity = "0.2";
                shuffleBtn.classList.remove("active");
                isShuffling = false;
                repeatBtn.classList.remove("repeat-all", "repeat-one");
                repeatBtn.querySelector("i").classList.remove("fa-repeat-1");
                repeatBtn.querySelector("i").classList.add("fa-repeat");
                repeatMode = 0;
                updateSongInfo("", "", "");
                playlistContainer.classList.remove("active");
                playlistList.style.display = "block";
                songList.classList.remove("active");
                songList.style.display = "none";
                backBtn.style.display = "none";
                showingSongs = false;
                currentPlaylistName.textContent = "Playlists";
                songslist.classList.remove("sidebar-open");
                if (isLightsOn) {
                    songslist.style.backgroundImage = `url('https://i.scdn.co/image/ab67616d0000b273e8c0e8b2f1a2f1a2f1a2f1a2')`;
                    songslist.style.opacity = '0.8';
                }
            }
        }

        function togglePlayIcon(songLi, isPlaying) {
            const icon = songLi.querySelector(".play-song");
            icon.classList.toggle("fa-play", !isPlaying);
            icon.classList.toggle("fa-pause", isPlaying);
        }

        function updateProgressBar() {
            clearInterval(progressInterval);
            progressInterval = setInterval(() => {
                if (currentAudio) {
                    const progress = (currentAudio.currentTime / currentAudio.duration) * 100;
                    progressBar.style.width = `${progress}%`;
                }
            }, 1000);
        }

        function seek(event) {
            if (!currentAudio) return;
            const rect = progressContainer.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const width = rect.width;
            const seekTo = (clickX / width) * currentAudio.duration;
            currentAudio.currentTime = seekTo;
            const progress = (seekTo / currentAudio.duration) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function toggleShuffle() {
            isShuffling = !isShuffling;
            shuffleBtn.classList.toggle("active");
            if (isShuffling && currentSongIndex >= 0) {
                playedIndices = [currentSongIndex];
            }
        }

        function toggleRepeat() {
            repeatMode = (repeatMode + 1) % 2;
            const repeatIcon = repeatBtn.querySelector("i");
            repeatBtn.classList.remove("repeat-all", "repeat-one");
            repeatIcon.classList.remove("fa-repeat", "fa-repeat-1");
            if (repeatMode === 0) {
                repeatIcon.classList.add("fa-repeat");
            } else if (repeatMode === 1) {
                repeatBtn.classList.add("repeat-all");
                repeatIcon.classList.add("fa-repeat");
            }
        }

        function togglePlaylistList() {
            if (playlistContainer.classList.contains("active")) {
                playlistContainer.classList.remove("active");
                songslist.classList.remove("sidebar-open");
            } else {
                loadPlaylists();
                showingSongs = false;
                currentPlaylistName.textContent = "Playlists";
                playlistList.style.display = "block";
                songList.classList.remove("active");
                songList.style.display = "none";
                backBtn.style.display = "none";
                playlistContainer.classList.add("active");
                songslist.classList.add("sidebar-open");
            }
        }

        function goBack() {
            showingSongs = false;
            currentPlaylistName.textContent = "Playlists";
            playlistList.style.display = "block";
            songList.classList.remove("active");
            songList.style.display = "none";
            backBtn.style.display = "none";
            loadPlaylists();
        }
        function toggleLights() {
            isLightsOn = !isLightsOn;
            lightsBtn.textContent = isLightsOn ? 'ðŸ”†' : 'ðŸŒ™';
            lightsBtn.style.color = isLightsOn ? '#ffd700' : '#b3b3b3';
            if (!isLightsOn) {
                songslist.style.backgroundColor = '';
                songslist.style.backgroundImage = `url('https://i.scdn.co/image/ab67616d0000b273e8c0e8b2f1a2f1a2f1a2f1a2')`;
                songslist.style.opacity = '0.8';
            } else {
                changeLights();
            }
        }

        function changeLights() {
            if (isLightsOn) {
                colorIndex = (colorIndex + 1) % lightColors.length;
                songslist.style.backgroundImage = 'none';
                songslist.style.backgroundColor = lightColors[colorIndex];
                songslist.style.opacity = '1';
                songslist.style.transition = 'background-color 0.5s ease';
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
    const customMenu = document.querySelector(".custom-menu");

    document.addEventListener("contextmenu", (event) => {
        event.preventDefault();
        customMenu.style.display = "block";
        customMenu.style.top = `${event.pageY}px`;
        customMenu.style.left = `${event.pageX}px`;
    });
    document.addEventListener("click", () => {
        customMenu.style.display = "none";
    });
    updateAllSongIcons();
});
        progressContainer.addEventListener("click", seek);
        volumeSlider.addEventListener("input", () => {
            if (currentAudio) {
                currentAudio.volume = volumeSlider.value;
            }
        });
        previousBtn.addEventListener("click", playPreviousSong);
        nextBtn.addEventListener("click", playNextSong);
        shuffleBtn.addEventListener("click", toggleShuffle);
        repeatBtn.addEventListener("click", toggleRepeat);
        listBtn.addEventListener("click", togglePlaylistList);
        backBtn.addEventListener("click", goBack);
        lightsBtn.addEventListener("click", toggleLights);
        playPauseBtn.addEventListener("click", togglePlayPause);

        document.addEventListener("click", e => {
            if (e.target.classList.contains("add-to-playlist")) {
                const songElement = e.target.parentNode;
                const songTitleElement = songElement.querySelector(".song-title");
                const song = {
                    title: songTitleElement ? songTitleElement.textContent : 'Unknown Title',
                    src: songElement.getAttribute("data-src") || '',
                    artist: songElement.getAttribute("data-artist") || '',
                    album: songElement.getAttribute("data-album") || ''
                };
                openAddToPlaylistPopup(song);
            }
        });

        // Popup resizing
        const popup = document.getElementById('popupContainer');
        const handle = document.getElementById('resizeHandle');
        let isDragging = false;
        let startX, startY, startScale = 1;

        handle.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            const matrix = window.getComputedStyle(popup).transform;
            if (matrix !== 'none') {
                const values = matrix.split('(')[1].split(')')[0].split(',');
                startScale = parseFloat(values[0]);
            }
            document.body.style.userSelect = 'none';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            const delta = Math.max(dx, dy);
            let newScale = startScale + delta / -300;
            newScale = Math.max(0.5, Math.min(2, newScale));
            popup.style.transform = `translateY(0) scale(${newScale})`;
        });

        document.addEventListener('mouseup', () => {
            if (isDragging) {
                isDragging = false;
                document.body.style.userSelect = '';
            }
        });
    </script>
</body>
</html>
